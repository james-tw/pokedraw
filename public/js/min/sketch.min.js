var __slice=Array.prototype.slice;!function($){var t;return $.fn.sketch=function(){var o,e,n;return e=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],this.length>1&&$.error("Sketch.js can only be called on one element at a time."),n=this.data("sketch"),"string"==typeof e&&n?n[e]?"function"==typeof n[e]?n[e].apply(n,o):0===o.length?n[e]:1===o.length?n[e]=o[0]:void 0:$.error("Sketch.js did not recognize the given command."):n?n:(this.data("sketch",new t(this.get(0),e)),this)},t=function(){function t(t,o){this.el=t,this.canvas=$(t),this.context=t.getContext("2d"),this.options=$.extend({toolLinks:!0,defaultTool:"marker",defaultColor:"#000000",defaultSize:5},o),this.painting=!1,this.color=this.options.defaultColor,this.size=this.options.defaultSize,this.tool=this.options.defaultTool,this.actions=[],this.action=[],this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent),this.options.toolLinks&&$("body").delegate('a[href="#'+this.canvas.attr("id")+'"]',"click",function(t){var o,e,n,i,s,a,r;for(e=$(this),o=$(e.attr("href")),i=o.data("sketch"),r=["color","size","tool"],s=0,a=r.length;a>s;s++)n=r[s],e.attr("data-"+n)&&i.set(n,$(this).attr("data-"+n));return $(this).attr("data-download")&&i.download($(this).attr("data-download")),$(this).attr("data-clear")&&i.clear(),!1})}return t.prototype.download=function(t){var o;return t||(t="png"),"jpg"===t&&(t="jpeg"),o="image/"+t,window.open(this.el.toDataURL(o))},t.prototype.clear=function(){return this.actions=[],this.action=null,this.redraw()},t.prototype.set=function(t,o){return this[t]=o,this.canvas.trigger("sketch.change"+t,o)},t.prototype.startPainting=function(){return this.painting=!0,this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]}},t.prototype.stopPainting=function(){return this.action&&this.actions.push(this.action),this.painting=!1,this.action=null,this.redraw()},t.prototype.onEvent=function(t){return t.originalEvent&&t.originalEvent.targetTouches&&(t.pageX=t.originalEvent.targetTouches[0].pageX,t.pageY=t.originalEvent.targetTouches[0].pageY),$.sketch.tools[$(this).data("sketch").tool].onEvent.call($(this).data("sketch"),t),t.preventDefault(),!1},t.prototype.redraw=function(){var t;return this.el.width=this.canvas.width(),this.context=this.el.getContext("2d"),t=this,$.each(this.actions,function(){return this.tool?$.sketch.tools[this.tool].draw.call(t,this):void 0}),this.painting&&this.action?$.sketch.tools[this.action.tool].draw.call(t,this.action):void 0},t}(),$.sketch={tools:{}},$.sketch.tools.marker={onEvent:function(t){switch(t.type){case"mousedown":case"touchstart":this.painting&&this.stopPainting(),this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}return this.painting?(this.action.events.push({x:t.pageX-this.canvas.offset().left,y:t.pageY-this.canvas.offset().top,event:t.type}),this.redraw()):void 0},draw:function(t){var o,e,n,i,s;for(this.context.lineJoin="round",this.context.lineCap="round",this.context.beginPath(),this.context.moveTo(t.events[0].x,t.events[0].y),s=t.events,n=0,i=s.length;i>n;n++)o=s[n],this.context.lineTo(o.x,o.y+1),e=o;return this.context.strokeStyle=t.color,this.context.lineWidth=t.size,this.context.stroke()}},$.sketch.tools.eraser={onEvent:function(t){return $.sketch.tools.marker.onEvent.call(this,t)},draw:function(t){var o;return o=this.context.globalCompositeOperation,this.context.globalCompositeOperation="copy",t.color="rgba(0,0,0,0)",$.sketch.tools.marker.draw.call(this,t),this.context.globalCompositeOperation=o}}}(jQuery);